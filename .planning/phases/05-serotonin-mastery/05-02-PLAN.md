---
phase: 05-serotonin-mastery
plan: 02
type: execute
---

<objective>
Add high-voice feature unlocks and comparative mastery indicators.

Purpose: Reward experienced practitioners with advanced features, trigger serotonin through comparative status.
Output: Feature unlocks for Mentor tier, optional comparative stats.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-serotonin-mastery/05-01-SUMMARY.md
@src/lib/voice.ts
@src/components/Settings.tsx
@src/components/TemplateEditor.tsx

**Feature unlock ideas:**
- Mentor tier: Access to create courses (multi-session sequences)
- Respected tier: Extended session durations (60+ minutes)
- Community-wide percentile ("More experience than 90% of practitioners")

**Serotonin trigger:** Earned features and comparative status
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add feature unlock definitions</name>
  <files>src/lib/featureUnlocks.ts</files>
  <action>
Create feature unlock system:

```typescript
/**
 * Feature Unlocks
 *
 * Some features are unlocked by Voice tier as earned privileges.
 * This rewards sustained engagement without paywall mechanics.
 */

import { VoiceTier } from './voice'

export interface FeatureUnlock {
  id: string
  name: string
  description: string
  requiredTier: VoiceTier
}

export const FEATURE_UNLOCKS: FeatureUnlock[] = [
  {
    id: 'extended_sessions',
    name: 'Extended Sessions',
    description: 'Sessions longer than 60 minutes',
    requiredTier: 'established'
  },
  {
    id: 'course_creation',
    name: 'Course Creation',
    description: 'Create multi-session meditation courses',
    requiredTier: 'mentor'
  },
  {
    id: 'advanced_insights',
    name: 'Advanced Insights',
    description: 'Deeper practice pattern analysis',
    requiredTier: 'respected'
  }
]

export function getUnlockedFeatures(tier: VoiceTier): FeatureUnlock[] {
  const tierOrder: VoiceTier[] = ['newcomer', 'practitioner', 'established', 'respected', 'mentor']
  const tierIndex = tierOrder.indexOf(tier)

  return FEATURE_UNLOCKS.filter(feature => {
    const requiredIndex = tierOrder.indexOf(feature.requiredTier)
    return tierIndex >= requiredIndex
  })
}

export function isFeatureUnlocked(featureId: string, tier: VoiceTier): boolean {
  const unlocked = getUnlockedFeatures(tier)
  return unlocked.some(f => f.id === featureId)
}
```

Features are rewards for sustained practice, not artificial gatekeeping.
  </action>
  <verify>Feature unlocks return correctly for each tier</verify>
  <done>Feature unlock system defined</done>
</task>

<task type="auto">
  <name>Task 2: Gate course creation behind Mentor tier</name>
  <files>src/components/TemplateEditor.tsx</files>
  <action>
Add unlock check to course creation:

```tsx
import { isFeatureUnlocked, getVoiceTier } from '@/lib/featureUnlocks'

// In component:
const voiceTier = getVoiceTier(userVoiceScore)
const canCreateCourses = isFeatureUnlocked('course_creation', voiceTier.tier)

// In render, wrap course creation section:
{canCreateCourses ? (
  <CourseCreationForm />
) : (
  <LockedFeatureCard
    feature="Course Creation"
    requiredTier="Mentor"
    currentTier={voiceTier.label}
    description="Continue practicing and contributing to unlock course creation"
  />
)}
```

Create LockedFeatureCard component that shows what's locked and how to unlock.
  </action>
  <verify>Course creation shows locked state for non-Mentor users</verify>
  <done>Course creation gated by Mentor tier</done>
</task>

<task type="auto">
  <name>Task 3: Add comparative mastery indicator</name>
  <files>src/components/VoiceDetailModal.tsx</files>
  <action>
Add optional percentile comparison:

```tsx
// Add to VoiceDetailModal after tier display:

interface ComparativeStats {
  hoursPercentile: number  // What % of users you have more hours than
}

// Fetch from Supabase (cached, not real-time):
// SELECT PERCENT_RANK() OVER (ORDER BY total_hours) FROM user_stats WHERE user_id = ?

{comparativeStats && voiceScore >= 70 && (
  <div className="mt-4 p-3 bg-accent-muted/30 rounded-lg text-center">
    <p className="text-sm text-ink">
      You've practiced more than{' '}
      <span className="font-medium text-accent">
        {Math.round(comparativeStats.hoursPercentile)}%
      </span>
      {' '}of practitioners
    </p>
  </div>
)}
```

Only show to Respected+ tiers - newer users don't need comparison pressure.
Language is positive ("more than X%") not negative ("only top Y%").
  </action>
  <verify>Comparative stat shows for high-voice users only</verify>
  <done>Comparative mastery indicator added</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Feature unlocks and comparative mastery</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. If you have a low voice score, verify:
       - Course creation shows "locked" state
       - No comparative percentile shown
    3. If you can simulate high voice (or use test account):
       - Course creation unlocked for Mentor
       - Comparative stat shows for Respected+
    4. Verify locked feature messaging is encouraging, not exclusionary
    5. Verify comparative stat language is positive
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Feature unlock system works
- [ ] Course creation gated appropriately
- [ ] Comparative stats only for experienced users
- [ ] Language is positive throughout
- [ ] Phase 05 complete
</verification>

<success_criteria>

- All tasks completed
- Experienced users feel recognized
- New users see path forward (not barriers)
- Serotonin triggered through earned status
</success_criteria>

<output>
After completion, create `.planning/phases/05-serotonin-mastery/05-02-SUMMARY.md`
</output>
