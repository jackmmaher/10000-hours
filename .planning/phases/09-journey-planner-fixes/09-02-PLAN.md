---
phase: 09-journey-planner-fixes
plan: 02
type: execute
---

<objective>
Add visual indicators for upcoming plans and today's date in calendar components.

Purpose: Provide clear visual feedback showing planned sessions are upcoming, differentiated from completed sessions.

Output: Calendar and WeekStones show distinct visual states for:

- Today's date (highlighted)
- Days with upcoming/incomplete plans (plan indicator)
- Days with both completed sessions AND upcoming plans (dual state)
  </objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09-journey-planner-fixes/09-01-PLAN.md (depends on this)

**Key files:**
@src/components/Calendar.tsx - Monthly calendar view
@src/components/WeekStones.tsx - Week visualization
@src/components/Journey/index.tsx - Week status computation

**Visual requirements from user:**

1. Today's date should be visually prominent in calendar (currently blends in)
2. Future planned sessions need color coding on calendar AND week stones
3. Days with BOTH completed session AND upcoming plan need dual indicator
4. Week stones should show "planned" state distinctly from "completed"
   </context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance Calendar visual indicators for dual-state days</name>
  <files>src/components/Calendar.tsx</files>
  <action>
Update Calendar rendering to handle dual-state days (has session + has upcoming plan):

1. Load ALL plans per day using `getAllPlansForDate()` (from Plan 01)
2. Filter for incomplete plans: `plans.filter(p => !p.completed && !p.linkedSessionUuid)`
3. For each calendar day, determine:
   - `hasCompletedSession`: session exists for this day
   - `hasUpcomingPlan`: incomplete plan exists for this day
4. Visual states:
   - Past + session: intensity color (existing)
   - Past + no session: muted (existing)
   - Today + session + plan: dual indicator (ring + filled)
   - Today + session only: filled with accent-muted bg (existing)
   - Today + plan only: accent text with plan indicator
   - Future + plan: accent color with small dot indicator
   - Future + no plan: secondary text (existing)

Add a small dot/indicator below the date number for days with upcoming plans.
The dot should be accent-colored for visibility.
</action>
<verify>

- Calendar shows distinct visual for today
- Days with plans show indicator dot
- Days with both session and plan show both indicators
  </verify>
  <done>
- Calendar renders dual-state days correctly
- Plan indicator visible on future dates
- Today is visually prominent
  </done>
  </task>

<task type="auto">
  <name>Task 2: Update WeekStones for dual-state and today highlighting</name>
  <files>src/components/WeekStones.tsx, src/components/Journey/index.tsx</files>
  <action>
Update WeekStones to handle dual-state days:

1. In `getDayStatusWithPlan()`, add new status: `'today-with-plan'` when isToday && hasPlan && !hasSession
2. Add `'dual'` status for days with both session and plan (session completed but another plan pending)
3. Update `WeekStone` component to render:
   - `'dual'`: Completed stone with small accent dot overlay (shows "you did one, have another planned")
   - `'today-with-plan'`: Today stone with plan indicator ring
4. In Journey/index.tsx `weekDays` computation:
   - Use `getAllPlansForDate()` to check for ANY incomplete plans (not just first)
   - Check if day has incomplete plans even when session exists

The key insight: A day can be "fulfilled" (completed a planned session) AND still have another upcoming plan.
</action>
<verify>

- WeekStones show dual indicator for days with session + pending plan
- Today with plan shows distinct state
- Week visualization accurately reflects planning status
  </verify>
  <done>
- WeekStones handle dual-state days
- Today is visually distinct
- All status combinations render correctly
  </done>
  </task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Visual indicators for calendar and week stones</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Go to Journey tab
    3. Look at the calendar:
       - Today's date should be visually prominent (highlighted background)
       - Any day with an upcoming plan should have a small dot indicator
    4. Look at week stones (This Week section):
       - Days with completed sessions: filled dark stone
       - Days with upcoming plans: accent-colored indicator
       - Days with both: dual indicator visible
    5. Plan a session for tomorrow, verify it shows plan indicator
    6. Plan a session for today at a future time, verify dual state if you have a completed session
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] Calendar shows plan indicators correctly
- [ ] WeekStones show dual-state correctly
- [ ] Today is visually prominent in both components
</verification>

<success_criteria>

- Calendar days with plans show dot indicator
- WeekStones show dual state for session + pending plan
- Today's date is clearly highlighted
- Visual distinction between completed and planned is clear
  </success_criteria>

<output>
After completion, create `.planning/phases/09-journey-planner-fixes/09-02-SUMMARY.md`
</output>
