---
phase: 06-endorphin-breath-pacing
plan: 02
type: execute
---

<objective>
Integrate breath pacing into Timer orb visualization and add post-session body awareness.

Purpose: Visual breath guide during meditation and body awareness prompt for extended endorphin window.
Output: Orb responds to breath phase, post-session body prompt.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-endorphin-breath-pacing/06-01-SUMMARY.md
@src/hooks/useBreathPacing.ts
@src/components/Timer.tsx
@src/components/InsightCapture.tsx

**Visual integration:**
- Orb grows on inhale, shrinks on exhale
- Subtle text indicator ("Breathe in" / "Breathe out")
- Doesn't fight with existing breathing animation - enhances it
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate breath pacing into Timer orb</name>
  <files>src/components/Timer.tsx</files>
  <action>
Connect breath pacing to orb visualization:

```tsx
import { useBreathPacing } from '@/hooks/useBreathPacing'
import { getBreathPattern } from '@/lib/breathPacing'
import { useSettings } from '@/lib/settingsStore'

// In Timer component:
const { breathPacing } = useSettings()
const activePattern = breathPacing.enabled
  ? getBreathPattern(breathPacing.defaultPattern || 'simple')
  : null

const breathState = useBreathPacing(activePattern, timerState === 'running')

// Calculate orb scale based on breath phase
const getOrbScale = () => {
  if (!breathState) return 1  // No pacing, default scale

  const { phase, progress } = breathState

  switch (phase) {
    case 'inhale':
      return 1 + (progress * 0.15)  // Scale from 1.0 to 1.15
    case 'exhale':
      return 1.15 - (progress * 0.15)  // Scale from 1.15 to 1.0
    case 'hold':
    case 'holdEmpty':
      return phase === 'hold' ? 1.15 : 1.0  // Hold at expanded or contracted
    default:
      return 1
  }
}

// Apply to orb container:
<div
  className="orb-container"
  style={{
    transform: `scale(${getOrbScale()})`,
    transition: 'transform 0.1s ease-out'
  }}
>
  {/* Existing orb layers */}
</div>

// Optional text indicator (below orb):
{breathState && (
  <p className="text-xs text-ink-soft/60 mt-4 text-center animate-pulse">
    {breathState.phase === 'inhale' && 'Breathe in...'}
    {breathState.phase === 'exhale' && 'Breathe out...'}
    {breathState.phase === 'hold' && 'Hold...'}
    {breathState.phase === 'holdEmpty' && 'Empty...'}
  </p>
)}
```

Scale change is subtle (15% max) to not distract from meditation.
Text is very subdued - presence, not demand.
  </action>
  <verify>Orb visually responds to breath phases</verify>
  <done>Breath pacing integrated into Timer orb</done>
</task>

<task type="auto">
  <name>Task 2: Add post-session body awareness prompt</name>
  <files>src/components/InsightCapture.tsx</files>
  <action>
Add body awareness prompt before insight capture:

```tsx
// Add state for body awareness step
const [showBodyAwareness, setShowBodyAwareness] = useState(true)

// Show body awareness first if session was 10+ minutes
const shouldShowBodyAwareness = session.durationSeconds >= 600  // 10 min

// Render body awareness before insight capture form:
{showBodyAwareness && shouldShowBodyAwareness && (
  <div className="text-center py-8">
    <p className="text-lg font-serif text-ink mb-4">
      Before you go...
    </p>
    <p className="text-sm text-ink-soft mb-6">
      Take a moment to notice how your body feels right now.
    </p>
    <p className="text-xs text-ink-soft/60 italic mb-8">
      Shoulders... jaw... breath... energy...
    </p>
    <button
      onClick={() => setShowBodyAwareness(false)}
      className="text-accent text-sm"
    >
      Continue
    </button>
  </div>
)}

{!showBodyAwareness && (
  <InsightCaptureForm ... />
)}
```

This extends the endorphin window by encouraging continued body awareness.
Only shows for sessions 10+ minutes to not interrupt quick sits.
  </action>
  <verify>Body awareness prompt shows after longer sessions</verify>
  <done>Post-session body awareness added</done>
</task>

<task type="auto">
  <name>Task 3: Add post-long-session stretch suggestion</name>
  <files>src/components/InsightCapture.tsx</files>
  <action>
For 30+ minute sessions, add gentle stretch suggestion:

```tsx
// For very long sessions (30+ min):
const isLongSession = session.durationSeconds >= 1800  // 30 min

{showBodyAwareness && shouldShowBodyAwareness && (
  <div className="text-center py-8">
    {/* ... existing body awareness content ... */}

    {isLongSession && (
      <p className="text-xs text-ink-soft/60 mt-4">
        Consider a gentle stretch before continuing with your day
      </p>
    )}
  </div>
)}
```

Just a suggestion, no tracking, no gamification.
  </action>
  <verify>Stretch suggestion shows for 30+ min sessions</verify>
  <done>Long session stretch suggestion added</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Breath pacing visual guide and body awareness prompts</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Go to Settings â†’ Enable breath pacing
    3. Select a pattern (e.g., "Simple")
    4. Start a meditation session
    5. Verify: Orb subtly grows/shrinks with breath phases
    6. Verify: Text indicator shows "Breathe in..." / "Breathe out..."
    7. Complete a 10+ minute session (or simulate)
    8. Verify: Body awareness prompt appears
    9. Tap "Continue" - insight capture appears
    10. For 30+ min session: verify stretch suggestion
    11. Disable breath pacing and verify orb returns to default animation
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Orb responds to breath phases when enabled
- [ ] Text indicator is subtle and helpful
- [ ] Body awareness shows for 10+ min sessions
- [ ] Stretch suggestion for 30+ min sessions
- [ ] All features respect opt-in settings
- [ ] Phase 06 complete
</verification>

<success_criteria>

- All tasks completed
- Breath guide enhances (not distracts) meditation
- Post-session prompts extend endorphin window
- Everything is opt-in and non-intrusive
</success_criteria>

<output>
After completion, create `.planning/phases/06-endorphin-breath-pacing/06-02-SUMMARY.md`
</output>
