---
phase: 02-audio-feedback
plan: 01
type: execute
---

<objective>
Create audio feedback infrastructure with completion chime and milestone sounds.

Purpose: Add a new sensory channel for reward moments, increasing dopamine through multi-modal feedback.
Output: Audio system with settings toggle, completion chime, and milestone sound.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/hooks/useTapFeedback.ts
@src/components/Settings.tsx

**Requirements:**
- Audio must respect device silent mode
- Default: OFF (opt-in feature)
- Small file sizes (< 50KB total)
- Living Theme integration: sounds should feel organic, not gamified
- Web Audio API for low-latency playback
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useAudioFeedback hook</name>
  <files>src/hooks/useAudioFeedback.ts</files>
  <action>
Create new hook that mirrors useTapFeedback but for audio:

```typescript
/**
 * useAudioFeedback - Optional audio cues for key moments
 *
 * Provides subtle audio feedback:
 * - Session complete: Gentle chime
 * - Milestone reached: Achievement tone
 * - Timer tick: Optional ticking (for longer sessions)
 *
 * Respects user preference (default: disabled)
 * Falls back gracefully if Web Audio unavailable
 */

import { useCallback, useRef, useEffect } from 'react'
import { useSettings } from '@/lib/settingsStore'

type AudioCue = 'complete' | 'milestone' | 'tick'

export function useAudioFeedback() {
  const { audioFeedbackEnabled } = useSettings()
  const audioContextRef = useRef<AudioContext | null>(null)

  // Lazy-init AudioContext on first interaction (browser requirement)
  const getAudioContext = useCallback(() => {
    if (!audioContextRef.current) {
      audioContextRef.current = new (window.AudioContext || (window as any).webkitAudioContext)()
    }
    return audioContextRef.current
  }, [])

  const play = useCallback((cue: AudioCue) => {
    if (!audioFeedbackEnabled) return

    const ctx = getAudioContext()
    if (ctx.state === 'suspended') ctx.resume()

    // Synthesized sounds (no external files needed)
    const oscillator = ctx.createOscillator()
    const gainNode = ctx.createGain()

    oscillator.connect(gainNode)
    gainNode.connect(ctx.destination)

    // Configure based on cue type
    switch (cue) {
      case 'complete':
        // Gentle major chord arpeggio
        oscillator.frequency.setValueAtTime(523.25, ctx.currentTime) // C5
        oscillator.frequency.setValueAtTime(659.25, ctx.currentTime + 0.1) // E5
        oscillator.frequency.setValueAtTime(783.99, ctx.currentTime + 0.2) // G5
        gainNode.gain.setValueAtTime(0.1, ctx.currentTime)
        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5)
        oscillator.start(ctx.currentTime)
        oscillator.stop(ctx.currentTime + 0.5)
        break

      case 'milestone':
        // Brighter, more celebratory
        oscillator.frequency.setValueAtTime(659.25, ctx.currentTime) // E5
        oscillator.frequency.setValueAtTime(783.99, ctx.currentTime + 0.15) // G5
        oscillator.frequency.setValueAtTime(987.77, ctx.currentTime + 0.3) // B5
        gainNode.gain.setValueAtTime(0.12, ctx.currentTime)
        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.6)
        oscillator.start(ctx.currentTime)
        oscillator.stop(ctx.currentTime + 0.6)
        break

      case 'tick':
        // Very subtle click
        oscillator.frequency.setValueAtTime(1000, ctx.currentTime)
        gainNode.gain.setValueAtTime(0.03, ctx.currentTime)
        gainNode.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.05)
        oscillator.start(ctx.currentTime)
        oscillator.stop(ctx.currentTime + 0.05)
        break
    }
  }, [audioFeedbackEnabled, getAudioContext])

  return {
    complete: () => play('complete'),
    milestone: () => play('milestone'),
    tick: () => play('tick'),
    play
  }
}
```

Use synthesized sounds via Web Audio API - no external audio files needed.
Keep volumes low (0.1-0.12 gain) for subtlety.
  </action>
  <verify>`npx tsc --noEmit` passes</verify>
  <done>Hook created with complete, milestone, tick sounds</done>
</task>

<task type="auto">
  <name>Task 2: Add audioFeedbackEnabled to settings store</name>
  <files>src/lib/settingsStore.ts</files>
  <action>
Add new setting to the settings store:

```typescript
audioFeedbackEnabled: boolean  // Default: false (opt-in)
```

Add to the settings interface, default state, and persist to localStorage.

Follow existing pattern for other boolean settings (like reducedMotion).
  </action>
  <verify>Setting persists across page reloads</verify>
  <done>audioFeedbackEnabled in settings store with persistence</done>
</task>

<task type="auto">
  <name>Task 3: Add Audio Feedback toggle to Settings UI</name>
  <files>src/components/Settings.tsx</files>
  <action>
Add toggle in the "Experience" or "Accessibility" section:

```tsx
<SettingRow
  label="Audio feedback"
  description="Play subtle sounds on session complete and milestones"
>
  <Toggle
    checked={settings.audioFeedbackEnabled}
    onChange={(checked) => {
      setSettings({ audioFeedbackEnabled: checked })
      if (checked) {
        // Preview the completion sound
        audioFeedback.complete()
      }
      tapFeedback.light()
    }}
  />
</SettingRow>
```

Add the toggle near other feedback settings.
When toggling ON, play a preview so user knows what to expect.
  </action>
  <verify>Toggle appears in Settings, plays preview on enable</verify>
  <done>Settings UI shows audio feedback toggle with preview</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npx tsc --noEmit` passes
- [ ] useAudioFeedback hook exports complete/milestone/tick functions
- [ ] Setting toggle appears in Settings
- [ ] Toggling ON plays preview sound
- [ ] Sounds respect audioFeedbackEnabled setting
</verification>

<success_criteria>

- All tasks completed
- TypeScript compiles without errors
- Audio feedback hook created with synthesized sounds
- Settings toggle added and functional
- Default is OFF (opt-in)
</success_criteria>

<output>
After completion, create `.planning/phases/02-audio-feedback/02-01-SUMMARY.md`
</output>
