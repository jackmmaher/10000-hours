---
phase: 07-gentle-reminders
plan: 02
type: execute
---

<objective>
Build NotificationCenter UI component and notification bell indicator.

Purpose: Give users a place to see and manage their in-app notifications.
Output: NotificationCenter component, bell icon with badge, notification list UI.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-gentle-reminders/07-01-SUMMARY.md
@src/lib/notifications.ts
@src/lib/db.ts
@src/components/Card.tsx

**Design requirements:**
- Bell icon in header with unread badge
- Slide-out or modal notification list
- Swipe to dismiss (mobile-friendly)
- Mark all read action
- Glassmorphic styling matching existing Card system
- Living Theme integration
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create NotificationBell component</name>
  <files>src/components/NotificationBell.tsx</files>
  <action>
Create bell icon component with unread badge:

```tsx
/**
 * NotificationBell - Header icon showing notification count
 *
 * Displays:
 * - Bell icon (subtle, theme-aware)
 * - Red dot/badge when unread > 0
 * - Opens NotificationCenter on tap
 */

import { useState, useEffect } from 'react'
import { getNotificationCount } from '@/lib/db'
import { useTapFeedback } from '@/hooks/useTapFeedback'

interface NotificationBellProps {
  onPress: () => void
}

export function NotificationBell({ onPress }: NotificationBellProps) {
  const [unreadCount, setUnreadCount] = useState(0)
  const tapFeedback = useTapFeedback()

  useEffect(() => {
    // Load count on mount
    getNotificationCount().then(setUnreadCount)

    // Poll every 30s for new notifications
    const interval = setInterval(() => {
      getNotificationCount().then(setUnreadCount)
    }, 30000)

    return () => clearInterval(interval)
  }, [])

  return (
    <button
      onClick={() => {
        tapFeedback.light()
        onPress()
      }}
      className="relative p-2"
      aria-label={`Notifications${unreadCount > 0 ? ` (${unreadCount} unread)` : ''}`}
    >
      {/* Bell SVG icon */}
      <svg className="w-6 h-6 text-ink-soft" /* ... */ />

      {/* Unread badge */}
      {unreadCount > 0 && (
        <span className="absolute top-1 right-1 w-2 h-2 bg-accent rounded-full" />
      )}
    </button>
  )
}
```

Use simple red dot for badge (not number) - less anxious.
  </action>
  <verify>Component renders, shows dot when count > 0</verify>
  <done>NotificationBell with unread indicator</done>
</task>

<task type="auto">
  <name>Task 2: Create NotificationCenter modal/sheet</name>
  <files>src/components/NotificationCenter.tsx</files>
  <action>
Create notification list component:

```tsx
/**
 * NotificationCenter - Modal showing all notifications
 *
 * Features:
 * - List of notifications (newest first)
 * - Swipe to dismiss
 * - Mark all as read
 * - Empty state when no notifications
 */

import { useState, useEffect } from 'react'
import { getUnreadNotifications, markAsRead, dismissNotification } from '@/lib/db'
import { InAppNotification } from '@/lib/notifications'
import { Card, CardBody } from '@/components/Card'

interface NotificationCenterProps {
  isOpen: boolean
  onClose: () => void
}

export function NotificationCenter({ isOpen, onClose }: NotificationCenterProps) {
  const [notifications, setNotifications] = useState<InAppNotification[]>([])

  useEffect(() => {
    if (isOpen) {
      getUnreadNotifications().then(setNotifications)
    }
  }, [isOpen])

  if (!isOpen) return null

  return (
    <div className="fixed inset-0 z-50 bg-bg-overlay/50 backdrop-blur-sm">
      <div className="absolute bottom-0 left-0 right-0 max-h-[70vh] bg-bg-elevated rounded-t-2xl">
        {/* Header */}
        <div className="flex items-center justify-between px-5 py-4 border-b border-ink/10">
          <h2 className="text-lg font-medium text-ink">Notifications</h2>
          <button onClick={onClose} className="text-ink-soft">Close</button>
        </div>

        {/* List */}
        <div className="overflow-y-auto max-h-[calc(70vh-60px)] px-4 py-3 space-y-3">
          {notifications.length === 0 ? (
            <p className="text-center text-ink-soft py-8">
              No new notifications
            </p>
          ) : (
            notifications.map((notif) => (
              <NotificationItem
                key={notif.id}
                notification={notif}
                onDismiss={() => {
                  dismissNotification(notif.id)
                  setNotifications(prev => prev.filter(n => n.id !== notif.id))
                }}
              />
            ))
          )}
        </div>
      </div>
    </div>
  )
}

function NotificationItem({ notification, onDismiss }) {
  // Render based on type with appropriate icon and styling
  const icons = {
    attribution: 'üíù',  // Heart for "your content helped"
    milestone: '‚ú®',     // Sparkle for achievement
    gentle_reminder: 'üßò' // Meditation for reminder
  }

  return (
    <Card variant="subtle">
      <CardBody className="flex items-start gap-3">
        <span className="text-xl">{icons[notification.type]}</span>
        <div className="flex-1">
          <p className="text-sm font-medium text-ink">{notification.title}</p>
          <p className="text-xs text-ink-soft">{notification.body}</p>
        </div>
        <button onClick={onDismiss} className="text-ink-soft">√ó</button>
      </CardBody>
    </Card>
  )
}
```

Style using existing Card components and Living Theme colors.
  </action>
  <verify>Modal opens, shows notifications, dismiss works</verify>
  <done>NotificationCenter UI with dismiss functionality</done>
</task>

<task type="auto">
  <name>Task 3: Wire NotificationBell into app header</name>
  <files>src/components/Header.tsx</files>
  <action>
Add NotificationBell to the app header (or wherever the main nav is):

1. Import NotificationBell and NotificationCenter
2. Add state for isNotificationCenterOpen
3. Render bell in header
4. Render NotificationCenter conditionally

```tsx
const [notificationCenterOpen, setNotificationCenterOpen] = useState(false)

// In header:
<NotificationBell onPress={() => setNotificationCenterOpen(true)} />

// At component end:
<NotificationCenter
  isOpen={notificationCenterOpen}
  onClose={() => setNotificationCenterOpen(false)}
/>
```

If no Header.tsx exists, add to the appropriate layout component (App.tsx or similar).
  </action>
  <verify>Bell appears in app, tapping opens notification center</verify>
  <done>Notification bell integrated into app navigation</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Bell icon visible in app header
- [ ] Tapping bell opens notification center
- [ ] Notifications display with correct icons
- [ ] Dismiss removes notification
- [ ] Empty state shows when no notifications
</verification>

<success_criteria>

- All tasks completed
- Users can view and manage notifications
- UI follows existing design system
- Phase 07 complete
</success_criteria>

<output>
After completion, create `.planning/phases/07-gentle-reminders/07-02-SUMMARY.md`
</output>
