---
phase: 07-gentle-reminders
plan: 01
type: execute
---

<objective>
Build in-app notification center infrastructure for attribution alerts and gentle reminders.

Purpose: Create the foundation for surfacing oxytocin-triggering attribution messages and gentle practice reminders without push notifications.
Output: NotificationCenter component, notification storage, and settings preferences.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/lib/db.ts
@src/lib/settingsStore.ts

**Requirements:**
- In-app only (no push notifications - requires native app)
- Notification types: attribution, milestone, gentle_reminder
- Notifications stored in IndexedDB
- User-configurable preferences
- Dismiss/snooze actions
- Zen philosophy: NO urgency, NO guilt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create notification types and storage schema</name>
  <files>src/lib/notifications.ts</files>
  <action>
Create notification system types and IndexedDB schema:

```typescript
/**
 * In-App Notification System
 *
 * Notification types:
 * - attribution: "Your meditation helped 3 people this week"
 * - milestone: "You reached 100 hours!"
 * - gentle_reminder: "Your planned session is in 30 minutes"
 *
 * Design principles:
 * - NO urgency language ("Don't miss!" forbidden)
 * - NO guilt ("You haven't meditated in X days" forbidden)
 * - Gentle, encouraging tone only
 */

export type NotificationType = 'attribution' | 'milestone' | 'gentle_reminder'

export interface InAppNotification {
  id: string
  type: NotificationType
  title: string
  body: string
  createdAt: Date
  readAt?: Date
  dismissedAt?: Date
  snoozedUntil?: Date
  // For attribution notifications
  metadata?: {
    contentId?: string      // Pearl or template ID
    helpedCount?: number    // How many people it helped
    timeframe?: string      // "this week", "today"
  }
}

// IndexedDB store name
export const NOTIFICATIONS_STORE = 'notifications'

// Add to db.ts schema (separate task)
```

Define types, not implementation yet.
  </action>
  <verify>Types export correctly, no TypeScript errors</verify>
  <done>Notification types and schema defined</done>
</task>

<task type="auto">
  <name>Task 2: Add notifications store to IndexedDB</name>
  <files>src/lib/db.ts</files>
  <action>
Add notifications object store to IndexedDB schema:

1. Increment DB version
2. Add 'notifications' store in upgrade handler:

```typescript
if (!db.objectStoreNames.contains('notifications')) {
  const store = db.createObjectStore('notifications', { keyPath: 'id' })
  store.createIndex('type', 'type', { unique: false })
  store.createIndex('createdAt', 'createdAt', { unique: false })
  store.createIndex('readAt', 'readAt', { unique: false })
}
```

3. Add CRUD helpers:
- `addNotification(notification: InAppNotification)`
- `getUnreadNotifications(): Promise<InAppNotification[]>`
- `markAsRead(id: string)`
- `dismissNotification(id: string)`
- `snoozeNotification(id: string, until: Date)`
- `getNotificationCount(): Promise<number>` (unread count)

Follow existing patterns in db.ts for IndexedDB operations.
  </action>
  <verify>DB migrations run, notifications store created</verify>
  <done>Notifications stored in IndexedDB with CRUD operations</done>
</task>

<task type="auto">
  <name>Task 3: Add notification preferences to settings</name>
  <files>src/lib/settingsStore.ts, src/components/Settings.tsx</files>
  <action>
Add notification preferences to settings:

```typescript
// In settingsStore.ts
interface Settings {
  // ... existing
  notifications: {
    attributionEnabled: boolean   // "Your content helped X people"
    milestoneEnabled: boolean     // Already have celebrations, this is for later reminder
    gentleRemindersEnabled: boolean // Planned session reminders
    reminderMinutesBefore: number  // 15, 30, 60 minutes before planned session
  }
}

// Defaults:
notifications: {
  attributionEnabled: true,      // Oxytocin trigger - default ON
  milestoneEnabled: true,        // Dopamine trigger - default ON
  gentleRemindersEnabled: false, // Opt-in for reminders
  reminderMinutesBefore: 30
}
```

Add to Settings UI in a "Notifications" section:
- Toggle for each type
- Dropdown for reminder timing (15/30/60 min)
  </action>
  <verify>Settings UI shows notification preferences, persists to localStorage</verify>
  <done>Notification preferences configurable in settings</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npx tsc --noEmit` passes
- [ ] Notification types defined
- [ ] IndexedDB store created on app load
- [ ] Settings UI shows notification preferences
- [ ] Preferences persist across sessions
</verification>

<success_criteria>

- All tasks completed
- Infrastructure ready for notification producers (attribution, milestones)
- No notifications sent yet - just the foundation
</success_criteria>

<output>
After completion, create `.planning/phases/07-gentle-reminders/07-01-SUMMARY.md`
</output>
