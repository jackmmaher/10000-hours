# Integrations

**Analysis Date:** 2026-01-10

## External Services

### Supabase

**Purpose:** Backend as a Service - Authentication + Database + Real-time

**Configuration:**
- Client: `src/lib/supabase.ts`
- Environment: `VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY` in `.env.local`
- Migrations: `supabase/` directory

**Tables Used:**
- `session_templates` - Community meditation templates
- `session_template_votes` - Upvotes/downvotes on templates
- `pearls` - Wisdom nuggets from practitioners
- `pearl_votes` - Votes on pearls
- `profiles` - User profile data

**Auth Flow:**
- Supabase Auth for email/password
- `src/stores/useAuthStore.ts` - Auth state management
- `src/components/AuthModal.tsx` - Login/signup UI

**Fallback:**
- When offline, app uses local IndexedDB data
- JSON seeds (`src/data/*.json`) as initial fallback

## Local Storage

### IndexedDB (Dexie)

**Purpose:** Offline-first persistent storage

**Configuration:**
- Schema: `src/lib/db.ts`
- Wrapper: Dexie 4.0.4

**Tables:**
- `sessions` - User's meditation sessions
- `sessionInsights` - Insights captured during sessions
- `savedTemplates` - Adopted meditation templates
- `savedPearls` - Saved wisdom pearls
- `plannedSessions` - Scheduled future meditations
- `templateDrafts` - User's template drafts

**Usage Pattern:**
```typescript
import { db } from './db'

// Create
await db.sessions.add({ ... })

// Read
const sessions = await db.sessions.toArray()

// Query
const recent = await db.sessions
  .where('date')
  .above(lastWeek)
  .toArray()
```

## Browser APIs

### Media APIs

**Voice Recording:**
- `src/services/voiceRecording.ts` - MediaRecorder API
- `src/hooks/useVoiceCapture.ts` - Audio capture hook
- `src/hooks/useAudioLevel.ts` - Audio level visualization

**Transcription:**
- `src/services/transcription.ts` - Speech-to-text
- Uses browser's Web Speech API or external service

### Geolocation

**Solar Position:**
- `src/lib/solarPosition.ts` - Sun altitude calculations
- Uses `navigator.geolocation` for user location
- Calculates accurate sunrise/sunset for theme

### PWA

**Service Worker:**
- Generated by `vite-plugin-pwa`
- Caches assets for offline use
- Configured in `vite.config.ts`

**Install Prompt:**
- `src/components/PWAInstallPrompt.tsx` - Install banner

## Third-Party Libraries

**Data Processing:**
- `date-fns` - Date manipulation throughout app
- `uuid` - Unique ID generation

**No External APIs:**
- No payment processing
- No analytics services
- No external CDN dependencies

---

*Integrations analysis: 2026-01-10*
*Update when new services added*
