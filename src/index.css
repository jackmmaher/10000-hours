@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  /* ========================================
   * LIVING THEME SYSTEM - CSS Variables
   *
   * All values set dynamically by themeEngine.ts
   * Default values here are Winter Daytime
   * ======================================== */

  /* === BACKGROUNDS === */
  --bg-base: #FAFBFC;
  --bg-elevated: #FFFFFF;
  --bg-deep: #F1F5F9;
  --bg-overlay: rgba(15, 23, 42, 0.5);
  --bg-warm: #FFFFFF; /* Legacy alias */

  /* === TEXT === */
  --text-primary: #1E293B;
  --text-secondary: #475569;
  --text-muted: #737373; /* Warm stone neutral for WCAG AA compliance (4.5:1 contrast) */
  --text-tertiary: #A8A29E; /* Warm stone - lighter than muted, for hints/metadata */
  --text-on-accent: #FFFFFF;

  /* === ACCENT === */
  --accent: #0EA5E9;
  --accent-hover: #0284C7;
  --accent-muted: rgba(14, 165, 233, 0.12);
  --accent-glow: rgba(14, 165, 233, 0.35);
  --accent-warm: #0284C7; /* Legacy alias */

  /* === ORB (Meditation Timer) === */
  --orb-core: #FFFFFF;
  --orb-mid: #F0F9FF;
  --orb-edge: #38BDF8;
  --orb-glow: rgba(14, 165, 233, 0.25);
  --orb-atmosphere: rgba(14, 165, 233, 0.08);
  --orb-primary: #38BDF8; /* Legacy alias */
  --orb-secondary: rgba(14, 165, 233, 0.25); /* Legacy alias */

  /* === STONES (Week indicators) === */
  --stone-completed: #475569;
  --stone-completed-inner: #64748B;
  --stone-planned: rgba(14, 165, 233, 0.15);
  --stone-planned-border: rgba(14, 165, 233, 0.5);
  --stone-empty: #E2E8F0;
  --stone-today: #CBD5E1;

  /* === CARDS === */
  --card-bg: #FFFFFF;
  --card-border: rgba(71, 85, 105, 0.08);
  --card-shadow: rgba(0, 0, 0, 0.06);

  /* === CALENDAR === */
  --calendar-day-bg: #FFFFFF;
  --calendar-day-text: #475569;
  --calendar-intensity-1: rgba(14, 165, 233, 0.15);
  --calendar-intensity-2: rgba(14, 165, 233, 0.35);
  --calendar-intensity-3: rgba(14, 165, 233, 0.55);
  --calendar-intensity-4: rgba(14, 165, 233, 0.75);

  /* === PROGRESS === */
  --progress-track: #E2E8F0;
  --progress-fill: #0EA5E9;
  --progress-glow: rgba(14, 165, 233, 0.25);
  --shimmer-color: rgba(255, 255, 255, 0.4);

  /* === INTERACTIVE === */
  --button-primary-bg: #0EA5E9;
  --button-primary-text: #FFFFFF;
  --button-secondary-bg: #F1F5F9;
  --button-secondary-text: #1E293B;
  --toggle-on: #0EA5E9;
  --toggle-off: #CBD5E1;
  --toggle-thumb: #FFFFFF;

  /* === BORDERS === */
  --border: rgba(71, 85, 105, 0.15);
  --border-subtle: rgba(71, 85, 105, 0.08);
  --divider: rgba(71, 85, 105, 0.08);

  /* === SHADOWS === */
  --shadow-color: rgba(0, 0, 0, 0.08);
  --shadow-elevation-1: 0 1px 3px rgba(0, 0, 0, 0.06), 0 1px 2px rgba(0, 0, 0, 0.04);
  --shadow-elevation-2: 0 4px 12px rgba(0, 0, 0, 0.08);
  --shadow-elevation-3: 0 8px 24px rgba(0, 0, 0, 0.1);

  /* === PEARLS === */
  --pearl-bg: #FFFFFF;
  --pearl-shimmer: rgba(255, 255, 255, 0.8);
  --pearl-orb: #E2E8F0;
  --pearl-orb-inner: #F1F5F9;

  /* === NAVIGATION === */
  --nav-bg: rgba(250, 251, 252, 0.95);
  --nav-active: #1E293B;
  --nav-inactive: #94A3B8;
  --pull-indicator: #0EA5E9;

  /* === VOICE BADGE (Credibility indicator) === */
  /* High Voice (70+) - Warm amber, earned credibility */
  --voice-high-bg: rgba(251, 191, 36, 0.15);
  --voice-high-text: #B45309;
  --voice-high-dot: #D97706;
  /* Established Voice (45-69) - Green/moss, solid contribution */
  --voice-established-bg: rgba(16, 185, 129, 0.12);
  --voice-established-text: #047857;
  --voice-established-dot: #10B981;
  /* Growing Voice (20-44) - Soft accent, building up */
  --voice-growing-bg: var(--accent-muted);
  --voice-growing-text: var(--text-secondary);
  --voice-growing-dot: var(--accent);
  /* New Voice (0-19) - Neutral, just starting */
  --voice-new-bg: var(--bg-deep);
  --voice-new-text: var(--text-muted);
  --voice-new-dot: var(--text-muted);

  /* === TIMER THEATER MODE === */
  --theater-center: #D8D4CE;
  --theater-edge: #A8A49E;
  --theater-glow: rgba(255, 255, 255, 0.9);

  /* === SEMANTIC: Error/Success States === */
  --error-bg: rgba(239, 68, 68, 0.08);
  --error-text: #DC2626;
  --success-bg: rgba(16, 185, 129, 0.12);
  --success-text: #059669;
  --success-icon: #10B981;

  /* === SEASONAL === */
  --seasonal-accent: #0EA5E9;

  /* === SYSTEM === */
  --theme-transition: 0.5s ease;
  --safe-area-top: env(safe-area-inset-top, 0px);
  --safe-area-bottom: env(safe-area-inset-bottom, 0px);

  /* === SPACING SCALE === */
  /* Non-negotiable scale: adjacent values differ by at least 25% */
  --space-1: 4px;
  --space-2: 8px;
  --space-3: 12px;
  --space-4: 16px;
  --space-6: 24px;
  --space-8: 32px;
  --space-12: 48px;
  --space-16: 64px;
  --space-24: 96px;
  --space-32: 128px;

  /* === TYPOGRAPHY SCALE === */
  /* Exactly 5 semantic text styles per Human-Crafted Design */

  /* Display - Hero text, total hours (fluid responsive)
     85% of median hero range for refined presence
     Scales proportionally: 82px min → 31vw fluid → 136px max
     iPhone SE (375px): ~116px | iPhone 13 (390px): ~121px | Pro Max (430px): ~133px */
  --text-display-size: clamp(5.1rem, 31vw, 8.5rem);
  --text-display-line: 1;
  --text-display-tracking: -0.02em;

  /* Heading - Section titles (24px / 1.2 / -0.01em) */
  --text-heading-size: 1.5rem;
  --text-heading-line: 1.2;
  --text-heading-tracking: -0.01em;

  /* Subheading - Card titles, labels (16px / 1.4 / 0) */
  --text-subheading-size: 1rem;
  --text-subheading-line: 1.4;
  --text-subheading-tracking: 0;

  /* Body - Primary content (14px / 1.5 / 0) */
  --text-body-size: 0.875rem;
  --text-body-line: 1.5;
  --text-body-tracking: 0;

  /* Caption - Metadata, hints (12px / 1.4 / 0.01em) */
  --text-caption-size: 0.75rem;
  --text-caption-line: 1.4;
  --text-caption-tracking: 0.01em;

  /* Label tracking - for uppercase labels */
  --tracking-wide: 0.05em;

  /* === TRANSITION TIMING === */
  /* Per Human-Crafted Design: fast/base/slow only */
  --transition-fast: 150ms ease-out;
  --transition-base: 200ms ease-out;
  --transition-slow: 300ms ease-in-out;

  /* Easing curves */
  --ease-out: cubic-bezier(0.33, 1, 0.68, 1);
  --ease-in-out: cubic-bezier(0.65, 0, 0.35, 1);
  --ease-organic: cubic-bezier(0.34, 1.56, 0.64, 1);

}

/* Theme transitions - smooth color changes */
html {
  transition:
    background-color var(--theme-transition),
    color var(--theme-transition);
}

* {
  transition:
    background-color var(--theme-transition),
    border-color var(--theme-transition),
    color var(--theme-transition),
    box-shadow var(--theme-transition);
}

* {
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
}

html, body, #root {
  height: 100%;
  margin: 0;
  padding: 0;
  overflow: hidden;
  background-color: var(--bg-base);
  color: var(--text-primary);
}

/* Default: fast transition for theme changes */
html, body {
  transition: background-color 0.3s ease;
}

/* Theater enter/exit: slow transition synced with footer fade (4s)
   Applied temporarily via JavaScript during theater mode transitions */
html.theater-transitioning,
html.theater-transitioning body {
  transition: background-color 4s cubic-bezier(0.25, 0.1, 0.25, 1) !important;
}

/* Theater mode color - iOS paints html/body into safe areas at OS level.
   Use --theater-edge to match vignette edge color at screen boundary. */
html.theater-mode,
html.theater-mode body {
  background-color: var(--theater-edge) !important;
}

/* Racing Mind practice mode - matches dark practice background */
html.racing-mind-transitioning,
html.racing-mind-transitioning body {
  transition: background-color 4s cubic-bezier(0.25, 0.1, 0.25, 1) !important;
}

html.racing-mind-mode,
html.racing-mind-mode body {
  background-color: #0A0A12 !important;
}

body {
  font-family: 'Raleway', system-ui, sans-serif;
  font-weight: 400;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#root {
  padding-top: var(--safe-area-top);
  padding-bottom: var(--safe-area-bottom);
}

/* Smooth number transitions */
.tabular-nums {
  font-variant-numeric: tabular-nums;
}

/* Prevent pull-to-refresh on iOS */
body {
  overscroll-behavior-y: contain;
}

/* Custom scrollbar - minimal, theme-aware */
::-webkit-scrollbar {
  width: 2px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: var(--text-muted);
  border-radius: 1px;
}

/* ========================================
 * LIVING ORB ANIMATIONS
 * Miyazaki-inspired luminous spirit
 * ======================================== */

/* Atmosphere breathing - the largest, subtlest layer */
@keyframes atmosphereBreathe {
  0%, 100% {
    transform: scale(1);
    opacity: 0.5;
  }
  50% {
    transform: scale(1.08);
    opacity: 0.3;
  }
}

/* Soft glow pulse - accent-tinted light emanation */
@keyframes glowPulse {
  0%, 100% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.15);
    opacity: 0.6;
  }
}

/* Pulse ring - breathing halo around the core */
@keyframes orbPulseRing {
  0%, 100% {
    transform: scale(1);
    opacity: 0.8;
  }
  50% {
    transform: scale(1.12);
    opacity: 0.3;
  }
}

/* Inner light bloom - gentle depth movement */
@keyframes orbInnerGlow {
  0%, 100% {
    transform: scale(1) translate(0, 0);
    opacity: 0.7;
  }
  33% {
    transform: scale(1.05) translate(1px, -1px);
    opacity: 1;
  }
  66% {
    transform: scale(0.98) translate(-0.5px, 0.5px);
    opacity: 0.5;
  }
}

@keyframes orbShimmer {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

/* Orb settling - gentle release at meditation end */
@keyframes orbSettle {
  0% {
    transform: scale(1);
    opacity: 1;
  }
  100% {
    transform: scale(0.92);
    opacity: 0.7;
  }
}

/* Orb breathing - dormant state, slower and subtler */
@keyframes orbBreathe {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.04);
  }
}

/* ========================================
 * BOX BREATHING ANIMATION (4-4-4-4)
 * Timer idle state - numbers as meditation object
 * ======================================== */

@keyframes boxBreathe {
  0% {
    transform: scale(1);
    opacity: 1;
  }
  25% {
    /* Inhale complete - expanded */
    transform: scale(1.03);
    opacity: 1;
  }
  50% {
    /* Hold at expanded */
    transform: scale(1.03);
    opacity: 1;
  }
  75% {
    /* Exhale complete - return to neutral */
    transform: scale(1);
    opacity: 1;
  }
  100% {
    /* Hold at neutral */
    transform: scale(1);
    opacity: 1;
  }
}

/* Transition animations for timer states */
@keyframes timerExhale {
  from {
    transform: scale(1);
    opacity: 1;
  }
  to {
    transform: scale(0.95);
    opacity: 0;
  }
}

@keyframes timerInhale {
  from {
    transform: scale(0.9);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

/* Session merge - rising and dissolving */
@keyframes sessionMergeRise {
  from {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
  to {
    transform: translateY(-30px) scale(0.6);
    opacity: 0;
  }
}

/* Cumulative merge - appearing from below */
@keyframes cumulativeMergeIn {
  from {
    transform: scale(0.95);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

/* Fade out animation */
@keyframes fadeOut {
  0% {
    opacity: 1;
  }
  100% {
    opacity: 0.3;
  }
}

.animate-fade-out {
  animation: fadeOut 3s ease-out forwards;
}

/* === GOOEY ORB ANIMATIONS === */
/* Blob movements create liquid/lava lamp effect when combined with SVG gooey filter */

/* Idle state - slow, meditative movements synced to 16s box breathing */
@keyframes gooeyBlob1Idle {
  0%, 100% {
    transform: translate(0, 0) scale(1);
  }
  25% {
    transform: translate(15px, -10px) scale(1.05);
  }
  50% {
    transform: translate(-10px, 15px) scale(1);
  }
  75% {
    transform: translate(-15px, -5px) scale(0.95);
  }
}

@keyframes gooeyBlob2Idle {
  0%, 100% {
    transform: translate(0, 0) scale(1);
  }
  25% {
    transform: translate(-12px, 12px) scale(0.95);
  }
  50% {
    transform: translate(10px, -8px) scale(1.05);
  }
  75% {
    transform: translate(8px, 10px) scale(1);
  }
}

@keyframes gooeyBlob3Idle {
  0%, 100% {
    transform: translate(0, 0) scale(1);
  }
  25% {
    transform: translate(8px, 8px) scale(1.1);
  }
  50% {
    transform: translate(-15px, -12px) scale(0.9);
  }
  75% {
    transform: translate(12px, -10px) scale(1);
  }
}

/* Core breathing synced to 16s box breathing (4-4-4-4) */
@keyframes gooeyCoreIdle {
  0%, 100% {
    transform: scale(1);
    opacity: 0.85;
  }
  25% {
    transform: scale(1.08);
    opacity: 1;
  }
  50% {
    transform: scale(1.08);
    opacity: 1;
  }
  75% {
    transform: scale(1);
    opacity: 0.85;
  }
}

/* Atmosphere breathing synced to 16s box breathing */
@keyframes atmosphereIdle {
  0%, 100% {
    transform: scale(1);
    opacity: 0.6;
  }
  25% {
    transform: scale(1.05);
    opacity: 0.8;
  }
  50% {
    transform: scale(1.05);
    opacity: 0.8;
  }
  75% {
    transform: scale(1);
    opacity: 0.6;
  }
}

/* Active state - more energetic, faster movements */
@keyframes gooeyBlob1Active {
  0%, 100% {
    transform: translate(0, 0) scale(1);
  }
  20% {
    transform: translate(20px, -15px) scale(1.1);
  }
  40% {
    transform: translate(-15px, 20px) scale(0.95);
  }
  60% {
    transform: translate(-20px, -10px) scale(1.05);
  }
  80% {
    transform: translate(15px, 15px) scale(1);
  }
}

@keyframes gooeyBlob2Active {
  0%, 100% {
    transform: translate(0, 0) scale(1);
  }
  20% {
    transform: translate(-18px, 18px) scale(0.9);
  }
  40% {
    transform: translate(15px, -12px) scale(1.1);
  }
  60% {
    transform: translate(12px, 15px) scale(1);
  }
  80% {
    transform: translate(-15px, -18px) scale(1.05);
  }
}

@keyframes gooeyBlob3Active {
  0%, 100% {
    transform: translate(0, 0) scale(1);
  }
  20% {
    transform: translate(12px, 12px) scale(1.15);
  }
  40% {
    transform: translate(-20px, -15px) scale(0.85);
  }
  60% {
    transform: translate(18px, -12px) scale(1.1);
  }
  80% {
    transform: translate(-10px, 18px) scale(0.95);
  }
}

/* Core pulse during active meditation */
@keyframes gooeyCore {
  0%, 100% {
    transform: scale(1);
    opacity: 0.9;
  }
  50% {
    transform: scale(1.15);
    opacity: 1;
  }
}

/* Atmosphere during active meditation */
@keyframes atmosphereActive {
  0%, 100% {
    transform: scale(1);
    opacity: 0.7;
  }
  50% {
    transform: scale(1.1);
    opacity: 0.9;
  }
}

/* Progress River shimmer - gentle flow of light */
@keyframes riverShimmer {
  0%, 100% {
    transform: translateX(-100%);
  }
  50% {
    transform: translateX(100%);
  }
}

/* Modal slide up animation */
@keyframes slideUp {
  from {
    transform: translateY(100%);
    opacity: 0.8;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.animate-slide-up {
  animation: slideUp 0.3s ease-out forwards;
}

/* Time range slider styling - theme aware */
.slider-thumb {
  -webkit-appearance: none;
  appearance: none;
}

.slider-thumb::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 28px;  /* Increased from 18px for better touch target (44pt min recommended) */
  height: 28px;
  border-radius: 50%;
  background: var(--text-primary);
  cursor: pointer;
  box-shadow: var(--shadow-elevation-1);
  transition: transform 0.15s ease;
}

.slider-thumb::-webkit-slider-thumb:hover {
  transform: scale(1.1);
}

.slider-thumb::-webkit-slider-thumb:active {
  transform: scale(0.95);
}

.slider-thumb::-moz-range-thumb {
  width: 28px;  /* Increased from 18px for better touch target */
  height: 28px;
  border: none;
  border-radius: 50%;
  background: var(--text-primary);
  cursor: pointer;
  box-shadow: var(--shadow-elevation-1);
}

/* Safe area utilities for navigation */
.safe-area-bottom {
  padding-bottom: env(safe-area-inset-bottom, 0px);
}

.safe-area-top {
  padding-top: env(safe-area-inset-top, 0px);
}

/* ========================================
 * ACCESSIBILITY: Focus States
 * Visible focus indicators for keyboard navigation
 * ======================================== */

/* Global focus-visible styles for all interactive elements */
button:focus-visible,
a:focus-visible,
input:focus-visible,
textarea:focus-visible,
select:focus-visible,
[role="button"]:focus-visible,
[tabindex]:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
  border-radius: 4px;
}

/* Subtler focus for elements that already have focus rings via Tailwind */
.focus-ring-custom:focus-visible {
  outline: none;
}

/* ========================================
 * FORM VALIDATION: Error States
 * Consistent error styling for form inputs
 * ======================================== */

/* Error state for inputs */
.input-error,
input.input-error,
textarea.input-error,
select.input-error {
  border-color: #EF4444 !important;
  background-color: rgba(239, 68, 68, 0.05);
}

.input-error:focus {
  outline-color: #EF4444;
  box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.15);
}

/* Error message styling */
.error-message {
  color: #DC2626;
  font-size: 0.75rem;
  margin-top: 0.375rem;
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.error-message::before {
  content: '';
  width: 0.875rem;
  height: 0.875rem;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23DC2626'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z'/%3E%3C/svg%3E");
  background-size: contain;
  flex-shrink: 0;
}

/* Warning state (for approaching limits) */
.input-warning,
input.input-warning,
textarea.input-warning {
  border-color: #F59E0B !important;
}

.warning-message {
  color: #D97706;
  font-size: 0.75rem;
  margin-top: 0.375rem;
}

/* Success state */
.input-success,
input.input-success,
textarea.input-success {
  border-color: #10B981 !important;
}

/* Character counter near limit */
.char-count-warning {
  color: #D97706;
}

.char-count-error {
  color: #DC2626;
}

/* ========================================
 * LOADING: Skeleton Animation
 * Smooth shimmer effect for loading states
 * ======================================== */

@keyframes skeletonWave {
  0% {
    background-position: -200% 0;
  }
  100% {
    background-position: 200% 0;
  }
}

.skeleton-wave {
  background: linear-gradient(
    90deg,
    var(--bg-deep) 25%,
    var(--bg-elevated) 50%,
    var(--bg-deep) 75%
  );
  background-size: 200% 100%;
  animation: skeletonWave 1.5s ease-in-out infinite;
}

/* ========================================
 * ACCESSIBILITY: Reduced Motion
 * Respect user's motion preferences
 * ======================================== */

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }

  /* Keep essential transitions but make them instant */
  html {
    transition: none;
  }

  /* Disable breathing/pulsing animations */
  .animate-breathe,
  .animate-pulse,
  .animate-spin,
  .animate-orb-breathe {
    animation: none !important;
  }
}

/* Utility: Hide scrollbar while maintaining scroll functionality */
.scrollbar-hide {
  -ms-overflow-style: none;
  scrollbar-width: none;
}
.scrollbar-hide::-webkit-scrollbar {
  display: none;
}

/* ========================================
 * iOS SAFARI: Date/Time Input Fixes
 * Force native inputs to respect container bounds
 * ======================================== */

/* Reset iOS Safari date/time input styling */
input[type="date"],
input[type="time"],
input[type="datetime-local"] {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  width: 100% !important;
  max-width: 100% !important;
  box-sizing: border-box !important;
  min-width: 0 !important;
}

/* Hide the native calendar/time picker indicator and use full-width tap target */
input[type="date"]::-webkit-calendar-picker-indicator,
input[type="time"]::-webkit-calendar-picker-indicator,
input[type="datetime-local"]::-webkit-calendar-picker-indicator {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  cursor: pointer;
  background: transparent;
}

/* Ensure inner elements don't overflow */
input[type="date"]::-webkit-datetime-edit,
input[type="time"]::-webkit-datetime-edit,
input[type="datetime-local"]::-webkit-datetime-edit {
  width: 100%;
  max-width: 100%;
  overflow: hidden;
}

input[type="date"]::-webkit-datetime-edit-fields-wrapper,
input[type="time"]::-webkit-datetime-edit-fields-wrapper,
input[type="datetime-local"]::-webkit-datetime-edit-fields-wrapper {
  width: 100%;
  max-width: 100%;
}
